## 1. MySQL主从复制

> ***面试官：MySQL主从复制了解吧？***

了解的面试官。MySQL主从复制保证了主库的数据可以同步到其他多台备库上，主要是利用了主库的**Binary Log**二进制文件。

1. 主库根据**事务提交的顺序**，把数据更改记录到二进制文件Binary Log中。
2. 备库建立TCP/IP连接后通过IO线程获取Binary Log，同时将Binary Log复制到中继日志**Relay Log。**
3. 备库再读取Realy Log中的事件，重放到备库的数据里。

![在这里插入图片描述](https://img-blog.csdnimg.cn/direct/a17801d54fb9409bbfd00e7010545ebe.png#pic_center)

> <br/>
>
> *面试官思考中…*
>
> <br/>

### 1.1 二进制文件的日志格式

> ***面试官：那这个日志格式是怎样的，有没听说过有好几种？***

主要有3种。

1. **基于语句**的二进制文件，保存了MySQL所有执行过的**SQL语句**，相当于从库需要把主库执行过的SQL都执行一遍。
2. **基于行**的二进制文件，把**行记录**发生的所有事件都保存起来。这种复制模式通常来说带宽压力更大些。
3. 混合模式。MySQL能够在以上两种复制模式之间动态切换，默认使用基于语句的复制方式，如果发现无法被正确复制，就切换成基于行的复制方式。

> <br/>
>
> *面试官思考中…*
>
> <br/>

### 1.2 二进制文件选择

> ***面试官：知道哪种二进制格式比较好吗？***

emmmm我认为是第二种。

是这样的，基于语句这种的话，有**数据不一致**的问题出现，例如某条删除SQL语句没有使用**order排序**，导致每次执行删除的数据都是不同的。

而第三种混合模式的话不确定因素太多，例如它采用了基于语句的模式，同样会发生刚刚我说到的问题。

> <br/>
>
> *面试官思考中…*
>
> <br/>

### 1.3 主从模式的优点

> ***面试官：那MySQL主从有什么好处吗？***

主要有三个方面。

1. 对于读密集的应用，可以利用MySQL主从将读操作负载均衡到多个从服务器上，来提高系统的抗压能力。
2. MySQL主从还可以避免单点问题，多个数据源支持查询来保证可用性。
3. 另外如果需要对MySQL进行版本升级，可以先对备库进步版本升级，保证查询可用的同时慢慢升级其他全部MySQL实例。



## 2. 全局事务标识符

> ***面试官：如果把二进制文件丢给从库，从库是不是复制整个文件？***

噢噢不是的。MySQL从库只会复制它本身缺失的最新数据，主要是利用了二进制文件里的**全局事务标识符**。

每一次**事务提交**，都会被分配一个唯一的全局事务标识符，MySQL从库是根据本身当前**全局事务标识符**找到二进制文件对应位置，才进行复制而不是复制全部。

> *面试官抓抓脑袋，继续看你的简历......*
>
> <br/>
>
> *emmmm，得想想考点你不懂的😰*